---
import Layout from '../layouts/Layout.astro';

interface Frontmatter {
  document_title?: string;
  [key: string]: any;
}

// Récupère tous les fichiers markdown pour lister les documents disponibles
const allPages = await Astro.glob<Frontmatter>('./output_2/**/*.md');

// Extrait les IDs de documents uniques
const documents = new Set<string>();
const docTitles: Record<string, string> = {};

allPages.forEach((page) => {
  const parts = page.file.split(/[/\\]/);
  const outputIndex = parts.indexOf('output_2');
  if (outputIndex !== -1 && parts.length > outputIndex + 1) {
    const docId = parts[outputIndex + 1];
    documents.add(docId);
    
    // Essaie de récupérer le titre depuis la première page ou n'importe quelle page
    if (page.frontmatter.document_title && !docTitles[docId]) {
      docTitles[docId] = page.frontmatter.document_title;
    }
  }
});

const docList = Array.from(documents).map(id => ({
  id,
  title: docTitles[id] || id
}));
---

<Layout>
	<div style="max-width: 800px; margin: 0 auto; padding: 2rem;">
		<h1 style="text-align: center; margin-bottom: 2rem; color: #8c5e58;">Bibliothèque</h1>
		
		<div class="grid">
			{docList.map(doc => (
				<a href={`/reader/${doc.id}`} class="card">
					<h2>{doc.title}</h2>
					<p>ID: {doc.id}</p>
				</a>
			))}
		</div>

    {docList.length === 0 && (
      <p style="text-align: center;">Aucun document trouvé dans output_2.</p>
    )}
	</div>
</Layout>

<style>
	.grid {
		display: grid;
		grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
		gap: 1.5rem;
	}
	
	.card {
		background: white;
		padding: 1.5rem;
		border-radius: 8px;
		box-shadow: 0 2px 4px rgba(0,0,0,0.1);
		text-decoration: none;
		color: inherit;
		transition: transform 0.2s, box-shadow 0.2s;
		border: 1px solid #eee;
	}
	
	.card:hover {
		transform: translateY(-2px);
		box-shadow: 0 4px 8px rgba(0,0,0,0.15);
		border-color: #8c5e58;
	}

	.card h2 {
		margin: 0 0 0.5rem 0;
		font-size: 1.2rem;
		color: #333;
	}

	.card p {
		margin: 0;
		font-size: 0.9rem;
		color: #666;
	}
</style>
