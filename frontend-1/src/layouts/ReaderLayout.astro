---
const { frontmatter } = Astro.props;
import "../styles/global.css";
---

<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="generator" content={Astro.generator} />
    <title>{frontmatter.title || "Liseuse"}</title>

    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&family=Open+Sans:wght@400;600&display=swap"
      rel="stylesheet"
    />

    <!-- KaTeX pour les maths -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.min.css"
      integrity="sha384-n8MVd4RsNIU0tAv4ct0nTaAbDJwPJzDEaqSD1odI+WdtXRGWt2kTvGFasHpSy3SV"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <button id="fullscreen-btn" title="Mode plein écran">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="24"
        height="24"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        ><path
          d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"
        ></path></svg
      >
    </button>
    <main class="reader-container">
      <article class="markdown-content">
        <slot />
      </article>
    </main>

    <script>
      const btn = document.getElementById("fullscreen-btn");

      btn?.addEventListener("click", () => {
        if (!document.fullscreenElement) {
          document.documentElement.requestFullscreen().catch((e) => {
            console.error(
              "Impossible de passer en plein écran automatiquement :",
              e
            );
          });
        } else {
          if (document.exitFullscreen) {
            document.exitFullscreen();
          }
        }
      });
    </script>
  </body>
</html>

<style is:global>
  /* === POLICES PERSONNALISÉES === */
  @font-face {
    font-family: "OpenDyslexic";
    src: url("/fonts/opendyslexic-0/OpenDyslexic-Regular.otf")
      format("opentype");
    font-weight: normal;
    font-style: normal;
    font-display: swap;
  }
  @font-face {
    font-family: "OpenDyslexic";
    src: url("/fonts/opendyslexic-0/OpenDyslexic-Italic.otf") format("opentype");
    font-weight: normal;
    font-style: italic;
    font-display: swap;
  }
  @font-face {
    font-family: "OpenDyslexic";
    src: url("/fonts/opendyslexic-0/OpenDyslexic-Bold.otf") format("opentype");
    font-weight: bold;
    font-style: normal;
    font-display: swap;
  }
  @font-face {
    font-family: "OpenDyslexic";
    src: url("/fonts/opendyslexic-0/OpenDyslexic-BoldItalic.otf")
      format("opentype");
    font-weight: bold;
    font-style: italic;
    font-display: swap;
  }

  @font-face {
    font-family: "Lexend";
    src: url("/fonts/Lexend/Lexend-VariableFont_wght.ttf") format("truetype");
    font-weight: 100 900;
    font-style: normal;
    font-display: swap;
  }

  /* === VARIABLES CSS PAR DÉFAUT === */
  :root {
    /* Couleurs de base */
    --bg-color: #fffbf0;
    --text-color: #2c2c2c;
    --accent-color: #8c5e58;
    --link-color: #8c5e58;
    --highlight-color: #ffff00;

    /* Typographie */
    --font-body: "Inter", "Merriweather", serif;
    --font-heading: "Open Sans", sans-serif;
    --font-code: "Fira Code", monospace;

    /* Paramètres de lecture (Liseuse) */
    --font-size-base: 18px;
    --line-height-base: 1.8;
    --letter-spacing-base: 0px;
    --word-spacing-base: 0px;
    --text-align: justify;

    /* Espacements */
    --paragraph-spacing: 1.5rem;
    --heading-margin-top: 2.5rem;
    --heading-margin-bottom: 1rem;
    --max-page-content-width: 800px;

    /* Couleurs syllabes */
    --syllabe-color-1: #2563eb;
    --syllabe-color-2: #dc2626;
    --syllabe-underline-1: #2563eb;
    --syllabe-underline-2: #dc2626;
  }

  /* === THÈMES === */
  :root.theme-light,
  body.theme-light {
    --bg-color: #ffffff;
    --text-color: #1a1a1a;
    --accent-color: #2563eb;
    --link-color: #2563eb;
  }

  :root.theme-sepia,
  body.theme-sepia {
    --bg-color: #f4ecd8;
    --text-color: #5b4636;
    --accent-color: #8c5e58;
    --link-color: #8c5e58;
  }

  :root.theme-dark,
  body.theme-dark {
    --bg-color: #1a1a1a;
    --text-color: #e0e0e0;
    --accent-color: #d4a5a5;
    --link-color: #93c5fd;
  }

  :root.theme-contrast,
  body.theme-contrast {
    --bg-color: #000000;
    --text-color: #ffff00;
    --accent-color: #ffff00;
    --link-color: #00ffff;
  }

  :root.theme-oled,
  body.theme-oled {
    --bg-color: #000000;
    --text-color: #ffffff;
    --accent-color: #ffffff;
    --link-color: #93c5fd;
  }

  /* === BASE === */
  html,
  body {
    margin: 0;
    padding: 0;
    background-color: var(--bg-color);
    color: var(--text-color);
    font-family: var(--font-body);
    transition:
      background-color 0.3s ease,
      color 0.3s ease;
  }

  .reader-container {
    max-width: 1300px;
    margin: 0 auto;
    padding: 4rem 2rem;
    min-height: 100vh;
  }

  @media (max-width: 768px) {
    .reader-container {
      padding: 0;
      max-width: 100%;
    }
  }

  .markdown-content {
    font-size: var(--font-size-base);
    line-height: var(--line-height-base);
    letter-spacing: var(--letter-spacing-base);
    word-spacing: var(--word-spacing-base);
    text-align: var(--text-align);
  }

  #fullscreen-btn {
    position: fixed;
    top: 1rem;
    right: 1rem;
    background: transparent;
    border: none;
    cursor: pointer;
    color: var(--text-color);
    opacity: 0.3;
    transition: all 0.2s;
    padding: 10px;
    border-radius: 50%;
    z-index: 100;
  }

  #fullscreen-btn:hover {
    opacity: 1;
    background: rgba(0, 0, 0, 0.05);
    transform: scale(1.1);
  }

  /* === TITRES === */
  h1,
  h2,
  h3,
  h4,
  h5,
  h6 {
    font-family: var(--font-heading);
    color: var(--text-color);
    line-height: 1.3;
  }

  /* === LIENS === */
  a {
    color: var(--link-color);
    text-decoration: none;
    transition: color 0.2s ease;
  }

  a:hover {
    text-decoration: underline;
  }

  /* === STYLES DYSLEXIE === */

  /* Segmentation syllabique */
  body.feature-segmentation-syllabique .syllabe-pair {
    color: var(--syllabe-color-1);
  }
  body.feature-segmentation-syllabique .syllabe-impair {
    color: var(--syllabe-color-2);
  }

  /* Alternance typographique */
  body.feature-alternement-typo .syllabe-bold {
    font-weight: 700;
  }
  body.feature-alternement-typo .syllabe-normal {
    font-weight: 400;
  }

  /* Soulignement syllabes */
  body.feature-soulignement-syllabes .syllabe-underline {
    text-decoration: underline;
    text-underline-offset: 3px;
  }
  body.feature-soulignement-syllabes .syllabe-underline-1 {
    text-decoration-color: var(--syllabe-underline-1);
  }
  body.feature-soulignement-syllabes .syllabe-underline-2 {
    text-decoration-color: var(--syllabe-underline-2);
  }

  /* Lettres muettes */
  body.feature-lettres-muettes .lettre-muette {
    opacity: 0.4;
    color: inherit;
  }

  /* === STYLES SÉMANTIQUES === */

  /* Noms propres */
  body.feature-nom-propre .nom-propre {
    background: linear-gradient(120deg, #a78bfa20 0%, #a78bfa40 100%);
    border-radius: 3px;
    padding: 0 3px;
    border-bottom: 2px solid #a78bfa;
  }

  /* Dates et chiffres */
  body.feature-date-chiffre .date-chiffre {
    background: linear-gradient(120deg, #f59e0b20 0%, #f59e0b40 100%);
    border-radius: 3px;
    padding: 0 3px;
    border-bottom: 2px solid #f59e0b;
  }

  /* Mots longs */
  body.feature-mot-long .mot-long {
    background: linear-gradient(120deg, #06b6d420 0%, #06b6d440 100%);
    border-radius: 3px;
    padding: 0 3px;
    border-bottom: 2px solid #06b6d4;
  }

  /* === FOCUS PARAGRAPHE === */
  body.feature-focus-paragraphe .page-content p,
  body.feature-focus-paragraphe .page-content li,
  body.feature-focus-paragraphe .page-content blockquote {
    opacity: 0.35;
    transition: opacity 0.25s ease;
  }

  body.feature-focus-paragraphe .page-content p:hover,
  body.feature-focus-paragraphe .page-content p.is-focused,
  body.feature-focus-paragraphe .page-content li:hover,
  body.feature-focus-paragraphe .page-content blockquote:hover {
    opacity: 1;
  }

  body.feature-focus-paragraphe .page-content h1,
  body.feature-focus-paragraphe .page-content h2,
  body.feature-focus-paragraphe .page-content h3,
  body.feature-focus-paragraphe .page-content h4,
  body.feature-focus-paragraphe .page-content h5,
  body.feature-focus-paragraphe .page-content h6 {
    opacity: 1;
  }

  /* === BARRE DE PROGRESSION === */
  body:not(.feature-barre-progression) .reading-progress-container {
    display: none;
  }

  /* === DALTONISME === */
  body.daltonism-protanopia img {
    filter: url("#protanopia");
  }
  body.daltonism-deuteranopia img {
    filter: url("#deuteranopia");
  }
  body.daltonism-tritanopia img {
    filter: url("#tritanopia");
  }
  body.daltonism-achromatopsia img {
    filter: grayscale(100%);
  }

  /* === MERMAID DIAGRAMS === */
  .mermaid,
  .rehype-mermaid-figure {
    display: flex;
    justify-content: center;
    margin: 2rem auto;
    max-width: 100%;
    overflow-x: auto;
  }

  .mermaid svg,
  .rehype-mermaid-figure svg {
    max-width: 100%;
    height: auto;
  }

  /* Adaptation au thème sombre */
  @media (prefers-color-scheme: dark) {
    .mermaid svg,
    .rehype-mermaid-figure svg {
      filter: invert(0.9) hue-rotate(180deg);
    }
  }

  /* Style pour les diagrammes dans le mode lecture */
  .page-content .mermaid,
  .page-content .rehype-mermaid-figure {
    background: rgba(255, 255, 255, 0.02);
    border-radius: 8px;
    padding: 1rem;
    border: 1px solid rgba(0, 0, 0, 0.05);
  }
</style>
