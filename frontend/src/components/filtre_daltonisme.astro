<!-- Filtres SVG pour Daltonisme -->
<svg style="width:0; height:0; position: absolute; visibility: hidden;">
  <defs>
    <filter id="protanopia">
      <feColorMatrix
        type="matrix"
        values="0.567, 0.433, 0, 0, 0
                                                 0.558, 0.442, 0, 0, 0
                                                 0, 0.242, 0.758, 0, 0
                                                 0, 0, 0, 1, 0"
      ></feColorMatrix>
    </filter>

    <filter id="deuteranopia">
      <feColorMatrix
        type="matrix"
        values="0.625, 0.375, 0, 0, 0
                                                 0.7, 0.3, 0, 0, 0
                                                 0, 0.3, 0.7, 0, 0
                                                 0, 0, 0, 1, 0"
      ></feColorMatrix>
    </filter>

    <filter id="tritanopia">
      <feColorMatrix
        type="matrix"
        values="0.95, 0.05, 0, 0, 0
                                                 0, 0.433, 0.567, 0, 0
                                                 0, 0.475, 0.525, 0, 0
                                                 0, 0, 0, 1, 0"
      ></feColorMatrix>
    </filter>

    <filter id="achromatopsia">
      <feColorMatrix
        type="matrix"
        values="0.299, 0.587, 0.114, 0, 0
                0.299, 0.587, 0.114, 0, 0
                0.299, 0.587, 0.114, 0, 0
                0, 0, 0, 1, 0"
      ></feColorMatrix>
    </filter>
  </defs>
</svg>

<script>
  import { usePersonnalisationStore } from "../stores/personnalisationStore";

  function applyDaltonism(mode: string) {
    document.body.classList.remove(
      "daltonism-protanopia",
      "daltonism-deuteranopia",
      "daltonism-tritanopia",
      "daltonism-achromatopsia"
    );
    if (mode !== "Aucun") {
      document.body.classList.add(`daltonism-${mode}`);
    }
  }

  // S'abonner aux changements du store
  usePersonnalisationStore.subscribe((state) => {
    applyDaltonism(state.daltonien);
  });

  // Appliquer l'Ã©tat initial
  const initialState = usePersonnalisationStore.getState();
  applyDaltonism(initialState.daltonien);
</script>

<style is:global>
  /* Filtres Daltonisme */
  body.daltonism-protanopia img {
    filter: url("#protanopia");
  }
  body.daltonism-deuteranopia img {
    filter: url("#deuteranopia");
  }
  body.daltonism-tritanopia img {
    filter: url("#tritanopia");
  }
  body.daltonism-achromatopsia img {
    filter: url("#achromatopsia");
  }
</style>
